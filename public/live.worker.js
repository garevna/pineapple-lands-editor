!function(t){var e={};function s(a){if(e[a])return e[a].exports;var n=e[a]={i:a,l:!1,exports:{}};return t[a].call(n.exports,n,n.exports,s),n.l=!0,n.exports}s.m=t,s.c=e,s.d=function(t,e,a){s.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:a})},s.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},s.t=function(t,e){if(1&e&&(t=s(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var a=Object.create(null);if(s.r(a),Object.defineProperty(a,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var n in t)s.d(a,n,function(e){return t[e]}.bind(null,n));return a},s.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return s.d(e,"a",e),e},s.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},s.p="",s(s.s=1)}([function(t,e,s){"use strict";s.r(e),s.d(e,"authController",(function(){return c})),s.d(e,"commonController",(function(){return f})),s.d(e,"landsController",(function(){return v})),s.d(e,"liveController",(function(){return E})),s.d(e,"mediaController",(function(){return q})),s.d(e,"filesController",(function(){return z}));const a={"fast-fibre-internet":"1","connect-melbourne-cbd":"2",conservatory:"2-1",qv1:"2-2",aurora:"2-3","3months":"3","refer-a-friend":"4",nbn:"5","dgtek-free-upgrade":"dgtek-1"},n={development:"https://pineapple-net-land.glitch.me",production:"https://api.pineapple.net.au",general:"content/general",testimonials:"testimonials",internetPlans:"content/plans",content:"content",pages:"content/live-pages",avatar:{static:"avatars",upload:"testimonials/avatar",get:"testimonials/avatars",delete:"testimonials/avatars",default:"avatars/default.png"},image:{static:"images",upload:"content/picture",get:"content/images",delete:"content/images",default:"images/default.jpg"},icon:{static:"icons",upload:"content/icon",get:"content/icons",delete:"content/icons",default:"icons/default.png"},getHost(){return"https://pa.pineapple.net.au"===location.origin?this.production:this.development},tokenEndpoint(){return this.getHost()+"/auth/token"},authEndpoint(){return this.getHost()+"/auth"},commonEndpoint(t){const e="testimonials"===t?"":"content/";return`${this.getHost()}/${e}${t}`},mediaListEndpoint(t){return`${this.getHost()}/${this[t].get}`},uploadEndpoint(t){return`${this.getHost()}/${this[t].upload}`},deleteEndpoint(t,e){return`${this.getHost()}/${this[t].delete}/fileName`},downloadEndpoint(t,e){return`${this.getHost()}/${this[t].static}/fileName`},landEndpoint(t){return`${this.getHost()}/content/${a[t]}`},live:{homeEndpoint:()=>n.getHost()+"/content/live",listEndpoint:()=>n.getHost()+"/content/live-pages",pageEndpoint:t=>`${n.getHost()}/content/live-${t}`}},r=(t,e)=>new Promise(e=>Object.assign(indexedDB.open(t),{onupgradeneeded:t=>(t.target.result.createObjectStore("common"),t.target.result.createObjectStore("live"),t.target.result.createObjectStore("lands"),t.target.result.createObjectStore("media"),t.target.result.createObjectStore("images"),t.target.result.createObjectStore("icons"),t.target.result.createObjectStore("avatars"),t.target.result),onsuccess:t=>e({status:200,result:t.target.result}),onerror:t=>e({status:700,result:null})})),u=async(t,e,s,a)=>new Promise(n=>{r(t).then(t=>{const{status:r,result:u}=t;if(200!==r)return void n({status:r,result:"Open IndexedDB error"});const i=u.transaction([e],"readwrite").objectStore(e);Object.assign(i.put(a,s),{onsuccess:()=>n({status:200,result:a}),onerror:()=>n({status:708,result:"IndexedDB saving data error"})})})}),i=(t,e,s)=>new Promise(a=>{r(t).then(t=>{const{status:n,result:r}=t;if(200!==n)return void a({status:n,result:null});const u=r.transaction([e]).objectStore(e);Object.assign(u.get(s),{onsuccess:t=>a({status:t.target.result?200:404,result:t.target.result?t.target.result:`The data ${s} not found in db store ${e}`}),onerror:t=>a({status:704,result:t.target.error})})})}),o=async(t,e)=>{const{status:s,result:a}=await i("pineapple","common","token");if(200!==s)return{status:401,result:"Unauthorized user. Access denied"};if(!navigator.onLine)return{status:0,result:"Offline mode: Data has not been saved. Try later"};return{status:(await fetch(t,{method:"POST",headers:{"Content-Type":"application/json;charset=utf-8",Authorization:a},body:JSON.stringify(e)})).status,result:null}};const l=async(t,e)=>await(async(t,e)=>{if(!navigator.onLine)return{status:0,result:"Offline mode: authorization is impossible"};const s=await fetch(n.authEndpoint(),{method:"POST",headers:{"Content-Type":"application/json;charset=utf-8"},body:JSON.stringify(e)});return{status:s.status,result:await s.text()}})(n.authEndpoint(),{login:t,password:e});const c=new class{async auth(t){const{status:e,result:s}=await l(t.login,t.password);return 200===e?await u("pineapple","common","token",s):{status:e,result:s}}async validateToken(){return await(async()=>{const{status:t,result:e}=await i("pineapple","common","token");if(200!==t)return{status:401,result:"Unauthorized user. Access denied"};if(!navigator.onLine)return{status:0,result:"Offline mode: Auth failed. Try later"};return 200!==(await fetch(n.tokenEndpoint(),{method:"GET",headers:{Authorization:e},body:null})).status?{status:403,result:"Auth failure. Access denied"}:{status:200,result:e}})()}},p=async t=>{if(!navigator.onLine)return{status:0,result:"Offline mode"};const e=await fetch(n.commonEndpoint(t));if(200!==e.status)return{status:e.status,result:await e.text()};const s=await e.json(),{status:a,result:r}=await u("pineapple","common",t,s);return{status:a,result:r}};async function d(t){const{status:e,result:s}=await i("pineapple","common",t);if(200!==e)return{status:e,result:s};const a=await o(n.commonEndpoint(t),s);return{status:a.status,result:a.result}}const f=new class{get(t){return(async t=>{const{status:e,result:s}=await i("pineapple","common",t);return 200===e?{status:e,result:s}:await p(t)})(t.key)}put(t){return(async(t,e)=>{const{status:s,result:a}=await u("pineapple","common",t,e);return 200!==s?{status:s,result:a}:await d(t)})(t.key,t.data)}store(t){return p(t.key)}save(t){return d(t.key)}};async function g(t){if(!navigator.onLine)return{status:0,result:"Offline mode"};const e=await fetch(n.landEndpoint(t));if(200!==e.status)return{status:e.status,result:await e.text()};const s=await e.json(),{status:a,result:r}=await u("pineapple","lands",t,s);return{status:a,result:r}}async function m(t){const{status:e,result:s}=await i("pineapple","lands",t);if(200!==e)return{status:e,result:s};return{status:(await o(n.landEndpoint(t),s)).status,result:null}}const v=new class{get(t){return(async t=>{const{status:e,result:s}=await i("pineapple","lands",t);return 200!==e?g(t):{status:e,result:s}})(t.key)}put(t){return(async(t,e)=>{const{status:s,result:a}=await u("pineapple","lands",t,e);return 200!==s?{status:s,action:"put",store:"lands",key:t,result:a}:await m(t)})(t.key,t.data)}store(t){return g(t.key)}save(t){return m(t.token,t.key)}};async function w(){if(!navigator.onLine)return{status:0,result:"Offline mode"};const t=await fetch(n.live.listEndpoint());if(200!==t.status)return{status:t.status,result:await t.text()};const e=await t.json(),{status:s,result:a}=await u("pineapple","live","list",e);return{status:s,result:a}}async function y(){if(!navigator.onLine)return{status:0,result:"Offline mode"};const t=await fetch(n.live.homeEndpoint());return 200!==t.status?{status:t.status,result:await t.text()}:await u("pineapple","live","home",await t.json())}async function h(t){if(!navigator.onLine)return{status:0,result:"Offline mode"};const e=await fetch(n.live.pageEndpoint(t));if(200!==e.status)return{status:e.status,result:await e.text()};const s=await e.json(),{status:a,result:r}=await u("pineapple","live",t,s);return{status:a,result:r}}async function b(){const{status:t,result:e}=await i("pineapple","live","list");if(200!==t)return{status:t,result:e};return{status:(await o(n.live.listEndpoint(),e)).status,result:e}}async function O(){const{status:t,result:e}=await i("pineapple","live","home");if(200!==t)return{status:t,result:e};return{status:(await o(n.live.homeEndpoint(),e)).status,result:null}}async function k(t){const{status:e,result:s}=await i("pineapple","live",t);if(200!==e)return{status:e,result:s};return{status:(await o(n.live.pageEndpoint(t),s)).status,result:null}}const j={get:{home:async()=>{const t=await i("pineapple","live","home");return 200===t.status?t:await y()},page:async t=>{const e=await i("pineapple","live",t);return 200===e.status?e:await h(t)},list:async()=>{const t=await i("pineapple","live","list");return 200===t.status?t:await w()}},put:{home:async t=>{const{status:e,result:s}=await u("pineapple","live","home",t);return 200!==e?{status:e,result:s}:await O()},page:async(t,e)=>{const{status:s,result:a}=await u("pineapple","live",t,e);return 200!==s?{status:s,result:a}:await k(t)},list:async t=>{const{status:e,result:s}=await u("pineapple","live","list",t);return 200!==e?{status:e,result:s}:await b()}},store:{home:y,page:h,list:w},save:{home:O,page:k,list:b}},$=t=>"list"===t.key||"home"===t.key?t.key:"page";const E=new class{get(t){return j.get[$(t)](t.key)}put(t){return"list"===t.key||"home"===t.key?j.put[$(t)](t.data):j.put[$(t)](t.key,t.data)}store(t){return j.store[$(t)](t.key)}save(t){return j.save[$(t)](t.key)}},I=["image","icon","avatar"];async function S(t){if(!navigator.onLine)return{status:0,result:`Offline mode. Remote resource ${t} is not available`};if(-1===I.indexOf(t))return{status:422,result:"Invalid request "+t};const e=await fetch(n.mediaListEndpoint(t));if(200!==e.status)return{status:e.status,result:await e.text()};const s=(await e.json()).filter(t=>".gitkeep"!==t),{status:a,result:r}=await u("pineapple","media",t,s);return{status:a,result:r}}const L=["image","icon","avatar"],A=async t=>{if(-1===L.indexOf(t))return{status:422,result:"Invalid request "+t};const{status:e,result:s}=await i("pineapple","media",t);return 200!==e?await S(t):{status:e,result:s}};async function x(t,e){if(!navigator.onLine)return{status:0,result:"Offline mode. Operation is impossible"};if(!t)return{status:422,result:"Store name missed"};if(!e)return{status:422,result:"File name missed"};const s=`${n.getHost()}/${t}/${e}`,a=await fetch(s);if(200!==a.status)return{status:a.status,result:`*** Reading ${s} failed`};const r=await a.blob(),{status:i}=await u("pineapple",t,e,r);return{status:i,result:200===i?URL.createObjectURL(r):`Storing ${e} failed`}}const T=async t=>{const{requestInitiatorId:e}=t,{status:s,result:a}=await i("pineapple",t.store,t.key);return 200!==s?await x(t.store,t.key):a instanceof Blob?{status:200,result:URL.createObjectURL(a),requestInitiatorId:e}:{status:422,result:`File ${t.key} has invalid format`,requestInitiatorId:e}},H={images:"image",icons:"icon",avatars:"avatar"};async function C(t){if(!(t.blob instanceof Blob))return{status:422,result:"Invalid file data"};const e=new File([t.blob],t.key,{lastModified:new Date}),s=new FormData;s.set(H[t.store],e);const a=await async function(t,e){const{status:s,result:a}=await i("pineapple","common","token");if(200!==s)return{status:403,result:"Unauthorized user. Access denied"};if(!navigator.onLine)return{status:0,result:"Offline mode: Operation failed. Try later"};const r=await fetch(n.uploadEndpoint(t),{method:"POST",headers:{Authorization:a},body:e});return{status:r.status,result:await r.text()}}(H[t.store],s);if(200===a.status){const{status:e}=await S(H[t.store]);200===e&&await x(t.store,t.key)}return Object.assign(a,{requestInitiatorId:t.requestInitiatorId})}const P=async t=>{const{status:e,result:s}=await(a="pineapple",u=t.store,o=t.key,new Promise(t=>{r(a).then(e=>{const{status:s,result:a}=e;if(200!==s)return void t({status:s,result:null});const n=a.transaction([u],"readwrite").objectStore(u);Object.assign(n.delete(o),{onsuccess:e=>t({status:e.target.result?200:404,result:e.target.result?e.target.result:`${o} not found in db store ${u}`}),onerror:e=>t({status:704,result:e.target.error})})})}));var a,u,o;if(200!==e)return{status:e,result:s};const l=await(async t=>{const{status:e,result:s}=i("pineapple","common","token");if(200!==e)return{status:403,result:"Unauthorized user. Access denied"};if(!navigator.onLine)return{status:0,result:"Offline mode: Operation failed. Try later"};return{status:(await fetch(t,{method:"DELETE",headers:{"Content-Type":"application/json;charset=utf-8",Authorization:s}})).status,result:null}})(n.deleteEndpoint(t.store,t.key));return 200===l.status&&S(t.store.slice(0,-1)),{status:l.status,result:null}};const q=new class{async get(t){return await A(t.key)}async store(t){return await S(t.key)}async save(t){return await async function(t){const{status:e,result:s}=await i("pineapple","media",t);return 200!==e?{status:e,result:s}:{status:(await o(n.live.mediaListEndpoint(t),s)).status,result:null}}(t.key)}async images(){return await(async()=>{const{status:t,result:e}=await A("image");if(200!==t)return{status:t,result:e};const s={};for(const t of e){const{status:e,result:a}=await x("images",t);s[t]=200!==e?null:a}return{status:200,result:s}})()}async icons(){return await(async()=>{const{status:t,result:e}=await A("icon");if(200!==t)return{status:t,result:e};const s={};for(const t of e){const{status:e,result:a}=await x("icons",t);s[t]=200!==e?null:a}return{status:200,result:s}})()}async avatars(){return await(async()=>{const{status:t,result:e}=await A("avatar");if(200!==t)return{status:t,result:e};const s={};for(const t of e){const{status:e,result:a}=await x("avatars",t);s[t]=200!==e?null:a}return{status:200,result:s}})()}async static(){return await(async t=>({status:200,result:{images:`${n.getHost()}/${n.image.static}`,icons:`${n.getHost()}/${n.icon.static}`,avatars:`${n.getHost()}/${n.avatar.static}`}}))()}};const z=new class{get(t){return T(t)}store(t){return x(t)}save(t){return C(t)}delete(t){return P(t)}getImage(t){return T(Object.assign(t,{store:"images"}))}getIcon(t){return T(Object.assign(t,{store:"icons"}))}getAvatar(t){return T(Object.assign(t,{store:"avatars"}))}storeImage(t){return x(Object.assign(t,{store:"images"}))}storeIcon(t){return x(Object.assign(t,{store:"icons"}))}storeAvatar(t){return x(Object.assign(t,{store:"avatars"}))}saveImage(t){return C(Object.assign(t,{store:"images"}))}saveIcon(t){return C(Object.assign(t,{store:"icons"}))}saveAvatar(t){return C(Object.assign(t,{store:"avatars"}))}deleteImage(t){return P(Object.assign(t,{store:"images"}))}deleteIcon(t){return P(Object.assign(t,{store:"icons"}))}deleteAvatar(t){return P(Object.assign(t,{store:"avatars"}))}}},function(t,e,s){"use strict";s.r(e);const{authController:a,commonController:n,landsController:r,liveController:u,mediaController:i,filesController:o}=s(0),l={auth:{auth:a.auth,token:a.validateToken},common:{auth:a.auth,token:a.validateToken,get:n.get,put:n.put,store:n.store,save:n.save},lands:{get:r.get,put:r.put,store:r.store,save:r.save},live:{get:u.get,put:u.put,store:u.store,save:u.save},media:{get:i.get,store:i.store,save:i.save,images:i.images,icons:i.icons,avatars:i.avatars,static:i.static},images:{get:o.getImage,store:o.storeImage,save:o.saveImage,delete:o.deleteImage},avatars:{get:o.getAvatar,store:o.storeAvatar,save:o.saveAvatar,delete:o.deleteAvatar},icons:{get:o.getIcon,store:o.storeIcon,save:o.saveIcon,delete:o.deleteIcon}};self.onmessage=t=>{const{store:e,action:s,key:a}=t.data;if(!l[e]||"function"!=typeof l[e][s])return n=t.data,void self.postMessage({status:422,result:`Invalid request\n ${n.action} ${n.store} ${n.key}`});var n;l[e][s](t.data).then(t=>self.postMessage(Object.assign({},{action:s,store:e,key:a},t)))}}]);